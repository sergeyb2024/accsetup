<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACC Telemetry Analysis Tool</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1"></script>
</head>
<body>
    <div class="container">
        <!-- Header with Theme Toggle -->
        <header class="app-header">
            <div class="header-content">
                <div class="header-text">
                    <h1>ACC Telemetry Analysis Tool</h1>
                    <p class="app-subtitle">Professional telemetry analysis for Assetto Corsa Competizione</p>
                </div>
                <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
                    <span class="theme-icon">üåô</span>
                </button>
            </div>
            <div class="car-info hidden" id="carInfo">
                <div class="car-name" id="carName"></div>
                <div class="car-class" id="carClass"></div>
            </div>
        </header>

        <!-- File Upload Section -->
        <section class="upload-section">
            <div class="upload-grid">
                <div class="upload-area">
                    <div class="upload-box" id="csvUpload">
                        <div class="upload-icon">üìä</div>
                        <h3>CSV Telemetry File</h3>
                        <p>Upload MoTeC CSV file with telemetry data</p>
                        <input type="file" id="csvFileInput" accept=".csv" class="file-input">
                        <button class="btn btn--outline" onclick="document.getElementById('csvFileInput').click()">
                            Choose File
                        </button>
                        <div class="upload-status" id="csvStatus"></div>
                        <div class="progress-bar" id="csvProgress">
                            <div class="progress-fill"></div>
                        </div>
                    </div>
                </div>
                
                <div class="upload-area">
                    <div class="upload-box" id="setupUpload">
                        <div class="upload-icon">‚öôÔ∏è</div>
                        <h3>Car Setup JSON</h3>
                        <p>Upload car setup configuration file</p>
                        <input type="file" id="setupFileInput" accept=".json" class="file-input">
                        <button class="btn btn--outline" onclick="document.getElementById('setupFileInput').click()">
                            Choose File
                        </button>
                        <div class="upload-status" id="setupStatus"></div>
                        <div class="progress-bar" id="setupProgress">
                            <div class="progress-fill"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sample-data-section">
                <button class="btn btn--secondary" id="loadSampleData">
                    Load Sample Data for Demo
                </button>
            </div>
        </section>

        <!-- Stability Gauges Section -->
        <section class="stability-gauges hidden" id="stabilityGauges">
            <div class="card">
                <div class="card__header">
                    <h2>Real-Time Stability Analysis</h2>
                    <p class="gauges-subtitle">Live car balance indicators</p>
                </div>
                <div class="card__body">
                    <div class="gauges-grid">
                        <div class="gauge-container">
                            <div class="gauge" id="balanceGauge">
                                <div class="gauge-needle" id="balanceNeedle"></div>
                                <div class="gauge-labels">
                                    <span class="gauge-label left">Understeer</span>
                                    <span class="gauge-label right">Oversteer</span>
                                </div>
                            </div>
                            <h4>Car Balance</h4>
                        </div>
                        
                        <div class="stability-meters">
                            <div class="meter-item">
                                <label>Understeer Events</label>
                                <div class="meter-bar">
                                    <div class="meter-fill understeer-meter" id="understeerMeter"></div>
                                </div>
                                <span class="meter-value" id="understeerValue">0</span>
                            </div>
                            
                            <div class="meter-item">
                                <label>Oversteer Events</label>
                                <div class="meter-bar">
                                    <div class="meter-fill oversteer-meter" id="oversteerMeter"></div>
                                </div>
                                <span class="meter-value" id="oversteerValue">0</span>
                            </div>
                            
                            <div class="meter-item">
                                <label>Overall Balance</label>
                                <div class="meter-bar">
                                    <div class="meter-fill" id="overallMeter"></div>
                                </div>
                                <span class="meter-value" id="overallValue">72</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Setup Controls Section -->
        <section class="setup-controls hidden" id="setupControls">
            <div class="card">
                <div class="card__header collapsible" id="setupHeader">
                    <div class="header-left">
                        <h2>Car Setup Parameters</h2>
                        <p class="setup-subtitle">Adjust parameters to analyze their impact on handling</p>
                    </div>
                    <button class="collapse-btn" id="setupCollapseBtn">
                        <span class="collapse-icon">‚ñº</span>
                    </button>
                </div>
                <div class="card__body collapsible-content" id="setupContent">
                    <div class="setup-validation" id="setupValidation"></div>
                    <div class="setup-grid" id="setupSliders">
                        <!-- Dynamic sliders will be generated here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Analysis Results Section -->
        <section class="analysis-section hidden" id="analysisSection">
            <!-- Charts Section with Tabs -->
            <div class="charts-container">
                <div class="chart-tabs">
                    <button class="chart-tab active" data-chart="stability">Stability Analysis</button>
                    <button class="chart-tab" data-chart="trajectory">Trajectory Analysis</button>
                    <button class="chart-tab" data-chart="eventMap">Event Map</button>
                </div>
                
                <div class="chart-panels">
                    <!-- Stability Chart -->
                    <div class="chart-panel active" id="stabilityPanel">
                        <div class="chart-header">
                            <div class="chart-info">
                                <h3>Stability Analysis</h3>
                                <p class="chart-subtitle">Understeer/Oversteer events over track distance (zoomable)</p>
                            </div>
                            <div class="chart-controls">
                                <button class="btn btn--outline btn--sm" id="stabilityReset" title="Reset Zoom">üîÑ</button>
                                <button class="btn btn--outline btn--sm" id="stabilityFullscreen" title="Full Screen">üìà</button>
                            </div>
                        </div>
                        <div class="chart-container" style="position: relative; min-height: 500px;">
                            <canvas id="stabilityChart"></canvas>
                        </div>
                        <div class="chart-legend">
                            <div class="legend-item">
                                <div class="legend-chip understeer"></div>
                                <span>Understeer</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-chip neutral"></div>
                                <span>Neutral</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-chip oversteer"></div>
                                <span>Oversteer</span>
                            </div>
                        </div>
                    </div>

                    <!-- Trajectory Chart -->
                    <div class="chart-panel" id="trajectoryPanel">
                        <div class="chart-header">
                            <div class="chart-info">
                                <h3>Trajectory Analysis</h3>
                                <p class="chart-subtitle">Optimal racing line vs actual trajectory with corner analysis (zoomable)</p>
                            </div>
                            <div class="chart-controls">
                                <button class="btn btn--outline btn--sm" id="trajectoryReset" title="Reset Zoom">üîÑ</button>
                                <button class="btn btn--outline btn--sm" id="trajectoryFullscreen" title="Full Screen">üìà</button>
                            </div>
                        </div>
                        <div class="chart-container" style="position: relative; min-height: 500px;">
                            <canvas id="trajectoryChart"></canvas>
                        </div>
                        <div class="chart-legend">
                            <div class="legend-item">
                                <div class="legend-line optimal"></div>
                                <span>Optimal Racing Line</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-line actual"></div>
                                <span>Actual Trajectory</span>
                            </div>
                            <div class="legend-item">
                                <div class="corner-speed slow"></div>
                                <span>Slow Corner</span>
                            </div>
                            <div class="legend-item">
                                <div class="corner-speed fast"></div>
                                <span>Fast Corner</span>
                            </div>
                        </div>
                    </div>

                    <!-- Event Map Chart -->
                    <div class="chart-panel" id="eventMapPanel">
                        <div class="chart-header">
                            <div class="chart-info">
                                <h3>Event Map</h3>
                                <p class="chart-subtitle">Ideal curve vs driving trajectory with understeer/oversteer events</p>
                            </div>
                            <div class="chart-controls">
                                <button class="btn btn--outline btn--sm" id="eventMapReset" title="Reset Zoom">üîÑ</button>
                                <button class="btn btn--outline btn--sm" id="eventMapFullscreen" title="Full Screen">üìà</button>
                            </div>
                        </div>
                        <div class="chart-container" style="position: relative; min-height: 500px;">
                            <canvas id="eventMapChart"></canvas>
                        </div>
                        <div class="chart-legend">
                            <div class="legend-item">
                                <div class="legend-line ideal"></div>
                                <span>Ideal Racing Curve</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-line driving"></div>
                                <span>Driving Trajectory</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-dot understeer-dot"></div>
                                <span>Understeer Events</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-dot oversteer-dot"></div>
                                <span>Oversteer Events</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recommendations Panel -->
            <div class="recommendations-panel">
                <div class="card">
                    <div class="card__header collapsible" id="recommendationsHeader">
                        <div class="header-left">
                            <h2>Setup Recommendations</h2>
                            <p class="recommendations-subtitle">Specific numeric suggestions with priority levels</p>
                        </div>
                        <button class="collapse-btn" id="recommendationsCollapseBtn">
                            <span class="collapse-icon">‚ñº</span>
                        </button>
                    </div>
                    <div class="card__body collapsible-content" id="recommendationsContent">
                        <div class="recommendations-filters">
                            <button class="filter-btn active" data-priority="all">All</button>
                            <button class="filter-btn" data-priority="critical">üîß Critical</button>
                            <button class="filter-btn" data-priority="moderate">‚öôÔ∏è Moderate</button>
                            <button class="filter-btn" data-priority="minor">üîç Minor</button>
                        </div>
                        <div class="recommendations-grid" id="recommendationsList">
                            <!-- Recommendations will be generated here -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Full Screen Chart Modal -->
        <div class="fullscreen-modal hidden" id="fullscreenModal">
            <div class="fullscreen-content">
                <div class="fullscreen-header">
                    <h3 id="fullscreenTitle"></h3>
                    <button class="btn btn--outline" id="closeFullscreen">‚úï</button>
                </div>
                <div class="fullscreen-chart-container">
                    <canvas id="fullscreenChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div class="loading-overlay hidden" id="loadingOverlay">
            <div class="loading-content">
                <div class="spinner"></div>
                <h3>Processing Telemetry Data...</h3>
                <p id="loadingMessage">Initializing analysis...</p>
                <div class="loading-progress">
                    <div class="loading-progress-bar" id="loadingProgressBar"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>